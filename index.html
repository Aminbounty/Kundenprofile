<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Kundenprofile</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f4f4f4; margin: 0; padding: 20px; }
    h1 { text-align: center; }
    .search-box { display: flex; justify-content: center; margin-bottom: 20px; }
    .search-box input { width: 300px; padding: 8px; border-radius: 8px; border: 1px solid #ccc; font-size: 14px; }
    .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; margin-top: 20px; }
    .card { background: white; padding: 15px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    .card h3 { margin: 0 0 10px 0; }
    .card button { margin-right: 8px; margin-top: 10px; padding: 6px 10px; border: none; border-radius: 6px; cursor: pointer; }
    .edit-btn { background: #ffc107; color: black; }
    .delete-btn { background: #dc3545; color: white; }
    .save-btn { background: #28a745; color: white; }
    .cancel-btn { background: #6c757d; color: white; }
    .add-form { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
    .add-form input, .add-form textarea, .add-form button { padding: 8px; border-radius: 8px; border: 1px solid #ccc; font-family: inherit; }
    .add-form textarea { flex: 1 1 100%; min-height: 60px; }
    .add-form button { background: #007bff; color: white; border: none; cursor: pointer; }
    .add-form button:hover { background: #0056b3; }
    .hidden { display: none; }
  </style>
</head>
<body>
  <h1>Kundenprofile</h1>

  <form class="add-form" id="addForm">
    <input type="text" id="name" placeholder="Name Kunde" required>
    <input type="text" id="seller" placeholder="Name Verkäufer" required>
    <input type="text" id="customerId" placeholder="Kundennummer">
    <input type="text" id="orderId" placeholder="Auftragsnummer">
    <textarea id="notes" placeholder="Notizen"></textarea>
    <label><input type="checkbox" id="isVelo"> Velo</label>
    <label><input type="checkbox" id="isMaterial"> Material</label>
    <div id="veloFields" class="hidden">
      <input type="text" id="brand" placeholder="Marke">
      <input type="text" id="model" placeholder="Modell">
      <input type="text" id="parking" placeholder="Parkplatz">
    </div>
    <div id="materialFields" class="hidden">
      <input type="text" id="description" placeholder="Beschreibung">
    </div>
    <button type="submit">Hinzufügen</button>
  </form>

  <div class="search-box">
    <input type="text" id="search" placeholder="Suche...">
  </div>

  <div class="grid" id="profileGrid"></div>

  <script>
    const form = document.getElementById("addForm");
    const grid = document.getElementById("profileGrid");
    const searchInput = document.getElementById("search");
    const isVelo = document.getElementById("isVelo");
    const isMaterial = document.getElementById("isMaterial");
    const veloFields = document.getElementById("veloFields");
    const materialFields = document.getElementById("materialFields");

    isVelo.addEventListener("change", () => { veloFields.classList.toggle("hidden", !isVelo.checked); });
    isMaterial.addEventListener("change", () => { materialFields.classList.toggle("hidden", !isMaterial.checked); });

    let profiles = JSON.parse(localStorage.getItem("profiles")) || [];

    function renderProfiles(filter = "") {
      grid.innerHTML = "";
      profiles.forEach((p, index) => {
        const searchText = (p.name + " " + p.seller + " " + (p.customerId||"") + " " + (p.orderId||"") +
                            " " + (p.notes||"") + " " + (p.brand||"") + " " + (p.model||"") +
                            " " + (p.parking||"") + " " + (p.description||"")).toLowerCase();
        if (!searchText.includes(filter.toLowerCase())) return;
        const card = document.createElement("div");
        card.className = "card";
        if (p.editing) {
          card.innerHTML = `
            <input type="text" id="edit-name-${index}" value="${p.name}" placeholder="Name Kunde"><br>
            <input type="text" id="edit-seller-${index}" value="${p.seller}" placeholder="Name Verkäufer"><br>
            <input type="text" id="edit-customerId-${index}" value="${p.customerId||""}" placeholder="Kundennummer"><br>
            <input type="text" id="edit-orderId-${index}" value="${p.orderId||""}" placeholder="Auftragsnummer"><br>
            <textarea id="edit-notes-${index}" placeholder="Notizen">${p.notes||""}</textarea><br>
            <label><input type="checkbox" id="edit-isVelo-${index}" ${p.isVelo?"checked":""}> Velo</label>
            <label><input type="checkbox" id="edit-isMaterial-${index}" ${p.isMaterial?"checked":""}> Material</label><br>
            <div id="edit-veloFields-${index}" ${p.isVelo?"":"class='hidden'"}>
              <input type="text" id="edit-brand-${index}" value="${p.brand||""}" placeholder="Marke"><br>
              <input type="text" id="edit-model-${index}" value="${p.model||""}" placeholder="Modell"><br>
              <input type="text" id="edit-parking-${index}" value="${p.parking||""}" placeholder="Parkplatz"><br>
            </div>
            <div id="edit-materialFields-${index}" ${p.isMaterial?"":"class='hidden'"}>
              <input type="text" id="edit-description-${index}" value="${p.description||""}" placeholder="Beschreibung"><br>
            </div>
            <button class="save-btn" onclick="saveEdit(${index})">Speichern</button>
            <button class="cancel-btn" onclick="cancelEdit(${index})">Abbrechen</button>`;
        } else {
          card.innerHTML = `
            <h3>${p.name}</h3>
            <p><strong>Verkäufer:</strong> ${p.seller}</p>
            <p><strong>Kundennummer:</strong> ${p.customerId||"-"}</p>
            <p><strong>Auftragsnummer:</strong> ${p.orderId||"-"}</p>
            <p><strong>Notizen:</strong><br>${p.notes||"-"}</p>
            ${p.isVelo ? `<p><strong>Velo:</strong> ${p.brand||"-"} ${p.model||"-"} (Parkplatz: ${p.parking||"-"})</p>` : ""}
            ${p.isMaterial ? `<p><strong>Material:</strong> ${p.description||"-"}</p>` : ""}
            <button class="edit-btn" onclick="editProfile(${index})">Bearbeiten</button>
            <button class="delete-btn" onclick="deleteProfile(${index})">Löschen</button>`;
        }
        grid.appendChild(card);
      });
    }

    function saveProfiles() { localStorage.setItem("profiles", JSON.stringify(profiles)); }
    form.addEventListener("submit", (e) => {
      e.preventDefault();
      const name = document.getElementById("name").value;
      const seller = document.getElementById("seller").value;
      const customerId = document.getElementById("customerId").value;
      const orderId = document.getElementById("orderId").value;
      const notes = document.getElementById("notes").value;
      const isVeloVal = isVelo.checked;
      const isMaterialVal = isMaterial.checked;
      const brand = document.getElementById("brand").value;
      const model = document.getElementById("model").value;
      const parking = document.getElementById("parking").value;
      const description = document.getElementById("description").value;
      profiles.push({ name, seller, customerId, orderId, notes, isVelo: isVeloVal, isMaterial: isMaterialVal,
                      brand, model, parking, description, editing: false });
      saveProfiles(); renderProfiles(searchInput.value); form.reset();
      veloFields.classList.add("hidden"); materialFields.classList.add("hidden");
    });
    function deleteProfile(index) { profiles.splice(index, 1); saveProfiles(); renderProfiles(searchInput.value); }
    function editProfile(index) { profiles[index].editing = true; renderProfiles(searchInput.value); }
    function cancelEdit(index) { profiles[index].editing = false; renderProfiles(searchInput.value); }
    function saveEdit(index) {
      const name = document.getElementById("edit-name-" + index).value;
      const seller = document.getElementById("edit-seller-" + index).value;
      const customerId = document.getElementById("edit-customerId-" + index).value;
      const orderId = document.getElementById("edit-orderId-" + index).value;
      const notes = document.getElementById("edit-notes-" + index).value;
      const isVeloVal = document.getElementById("edit-isVelo-" + index).checked;
      const isMaterialVal = document.getElementById("edit-isMaterial-" + index).checked;
      const brand = document.getElementById("edit-brand-" + index)?.value || "";
      const model = document.getElementById("edit-model-" + index)?.value || "";
      const parking = document.getElementById("edit-parking-" + index)?.value || "";
      const description = document.getElementById("edit-description-" + index)?.value || "";
      profiles[index] = { name, seller, customerId, orderId, notes, isVelo: isVeloVal, isMaterial: isMaterialVal,
                          brand, model, parking, description, editing: false };
      saveProfiles(); renderProfiles(searchInput.value);
    }
    searchInput.addEventListener("input", () => { renderProfiles(searchInput.value); });
    renderProfiles();
  </script>
</body>
</html>
