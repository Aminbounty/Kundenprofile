<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Kundenprofile (Cloud-Version)</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f4f4f4; margin: 0; padding: 20px; }
    h1 { text-align: center; }
    .search-box { display: flex; justify-content: center; margin-bottom: 20px; }
    .search-box input { width: 300px; padding: 8px; border-radius: 8px; border: 1px solid #ccc; font-size: 14px; }
    .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; margin-top: 20px; }
    .card { background: white; padding: 15px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    .card h3 { margin: 0 0 10px 0; }
    .card button { margin-right: 8px; margin-top: 10px; padding: 6px 10px; border: none; border-radius: 6px; cursor: pointer; }
    .edit-btn { background: #ffc107; color: black; }
    .delete-btn { background: #dc3545; color: white; }
    .save-btn { background: #28a745; color: white; }
    .cancel-btn { background: #6c757d; color: white; }
    .add-form { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
    .add-form input, .add-form textarea, .add-form button { padding: 8px; border-radius: 8px; border: 1px solid #ccc; font-family: inherit; }
    .add-form textarea { flex: 1 1 100%; min-height: 60px; }
    .add-form button { background: #007bff; color: white; border: none; cursor: pointer; }
    .add-form button:hover { background: #0056b3; }
    .hidden { display: none; }
  </style>
</head>
<body>
  <h1>Kundenprofile (Cloud-Version)</h1>

  <form class="add-form" id="addForm">
    <input type="text" id="name" placeholder="Name Kunde" required>
    <input type="text" id="seller" placeholder="Name Verk채ufer" required>
    <input type="text" id="customerId" placeholder="Kundennummer">
    <input type="text" id="orderId" placeholder="Auftragsnummer">
    <textarea id="notes" placeholder="Notizen"></textarea>
    <label><input type="checkbox" id="isVelo"> Velo</label>
    <label><input type="checkbox" id="isMaterial"> Material</label>
    <div id="veloFields" class="hidden">
      <input type="text" id="brand" placeholder="Marke">
      <input type="text" id="model" placeholder="Modell">
      <input type="text" id="parking" placeholder="Parkplatz">
    </div>
    <div id="materialFields" class="hidden">
      <input type="text" id="description" placeholder="Beschreibung">
    </div>
    <button type="submit">Hinzuf체gen</button>
  </form>

  <div class="search-box">
    <input type="text" id="search" placeholder="Suche...">
  </div>

  <div class="grid" id="profileGrid"></div>

  <script>
    const API_URL = "https://script.google.com/macros/s/AKfycbxREeyiC3Ps04D-3XUFE12muAbpEdrsJ75SMiGIZUa6i7dt2eAVljwkb5_3VpJ2PPvrvA/exec";

    const form = document.getElementById("addForm");
    const grid = document.getElementById("profileGrid");
    const searchInput = document.getElementById("search");
    const isVelo = document.getElementById("isVelo");
    const isMaterial = document.getElementById("isMaterial");
    const veloFields = document.getElementById("veloFields");
    const materialFields = document.getElementById("materialFields");

    isVelo.addEventListener("change", () => { veloFields.classList.toggle("hidden", !isVelo.checked); });
    isMaterial.addEventListener("change", () => { materialFields.classList.toggle("hidden", !isMaterial.checked); });

    async function loadProfiles() {
      grid.innerHTML = "<p style='text-align:center'>Lade Daten...</p>";
      try {
        const res = await fetch(API_URL);
        const data = await res.json();
        renderProfiles(data);
      } catch (err) {
        grid.innerHTML = "<p style='color:red; text-align:center'>Konnte Daten nicht laden. Pr체fe deine API-URL oder Berechtigungen.</p>";
      }
    }

    async function saveProfile(profile) {
      await fetch(API_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(profile)
      });
    }

    function renderProfiles(profiles, filter = "") {
      grid.innerHTML = "";
      profiles
        .filter(p => Object.values(p).join(" ").toLowerCase().includes(filter.toLowerCase()))
        .forEach((p) => {
          const card = document.createElement("div");
          card.className = "card";
          card.innerHTML = `
            <h3>${p.name || "-"}</h3>
            <p><strong>Verk채ufer:</strong> ${p.seller || "-"}</p>
            <p><strong>Kundennummer:</strong> ${p.customerId || "-"}</p>
            <p><strong>Auftragsnummer:</strong> ${p.orderId || "-"}</p>
            <p><strong>Notizen:</strong> ${p.notes || "-"}</p>
            ${p.isVelo === "true" ? `<p><strong>Velo:</strong> ${p.brand || "-"} ${p.model || "-"} (Parkplatz: ${p.parking || "-"})</p>` : ""}
            ${p.isMaterial === "true" ? `<p><strong>Material:</strong> ${p.description || "-"}</p>` : ""}
          `;
          grid.appendChild(card);
        });
    }

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const profile = {
        name: document.getElementById("name").value,
        seller: document.getElementById("seller").value,
        customerId: document.getElementById("customerId").value,
        orderId: document.getElementById("orderId").value,
        notes: document.getElementById("notes").value,
        isVelo: isVelo.checked,
        isMaterial: isMaterial.checked,
        brand: document.getElementById("brand").value,
        model: document.getElementById("model").value,
        parking: document.getElementById("parking").value,
        description: document.getElementById("description").value
      };
      await saveProfile(profile);
      form.reset();
      veloFields.classList.add("hidden");
      materialFields.classList.add("hidden");
      await loadProfiles();
    });

    searchInput.addEventListener("input", async () => {
      const res = await fetch(API_URL);
      const data = await res.json();
      renderProfiles(data, searchInput.value);
    });

    loadProfiles();
  </script>
</body>
</html>
